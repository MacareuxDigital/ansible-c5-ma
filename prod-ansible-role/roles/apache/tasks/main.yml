- name: Install Apache and PHP for Amazon Linux
  when: aws_awslinux=="yes"
  yum: name={{item}} state=latest
  with_items:
  - "httpd24"
  - "php70"
  - "php70-devel"
  - "php70-cli"
  - "php70-gd"
  - "php70-mbstring"
  - "php70-pecl-memcached"
  - "php70-mysqlnd"
  - "php70-xml"
  - "php70-opcache"
  - "php70-mcrypt"
  - "php70-zip"
  - "jq"

- name: Install Apache and PHP for CentOS7
  when: aws_awslinux!="yes"
  yum: name={{item}} state=latest
  with_items:
  - "httpd24"
  - "php71w"
  - "php71w-common"
  - "php71w-cli"
  - "php71w-devel"
  - "php71w-fpm"
  - "php71w-gd"
  - "php71w-intl"
  - "php71w-pecl-imagick"
  - "php71w-pdo"
  - "php71w-pecl-memcached"
  - "php71w-mbstring"
  - "php71w-mcrypt"
  - "php71w-mysqlnd"
  - "php71w-opcache"
  - "php71w-soap"
  - "php71w-xml"
  - "jq"


- name: Start httpd
  service: name=httpd enabled=yes

- name: Add User to Apache-group
  user: name={{ item }} groups=apache state=present
  with_items: "{{ add_users }}"

- name: Add Apache to User-group
  user: name=apache groups={{ item }} state=present
  with_items: "{{ add_users }}"

- include: set_php-fpm.yml
- include: set_php.yml
- include: set_apache.yml
- include: set_apache-vhosts.yml
- include: set_htaccess.yml
